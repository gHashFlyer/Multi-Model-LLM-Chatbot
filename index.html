<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Multi-Model LLM Chatbot</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" aria-label="Toggle Menu">‚ò∞</button>
    
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí ‚ñí</h1>
                <button class="new-chat-btn" onclick="createNewConversation()">+ New Chat</button>
            </div>
            <div class="conversations-list" id="conversationsList">
                <!-- Conversations will be dynamically inserted here -->
            </div>
            <div class="sidebar-footer">
                <!-- Moved API Keys and Theme Toggle to right sidebar -->
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
            <header class="chat-header">
                <div class="header-left">
                    <div class="current-model-display">
                        <span class="model-label">Model:</span>
                        <span class="model-name" id="currentModelName">None</span>
                    </div>
                </div>
                <div class="header-center">
                    <div class="clock-display">
                        <span id="localTime">00:00:00</span>
                        <span class="utc-time" id="utcTime">UTC: 00:00:00</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="cost-display">
                        <span class="cost-label">Session Cost:</span>
                        <span class="cost-value" id="costDisplay">$0.0000</span>
                        <span class="cost-label" style="margin-left: 10px;">Tokens:</span>
                        <span class="cost-value" id="tokensDisplay">0</span>
                    </div>
                    <button class="toggle-right-sidebar-btn" onclick="toggleRightSidebar()" title="Toggle Settings">‚öôÔ∏è</button>
                </div>
            </header>

            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be rendered dynamically -->
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Type your message here... (Press Enter for new line)"
                        rows="1"
                        onkeydown="handleKeyDown(event)"
                        oninput="autoResizeTextarea(this)"
                    ></textarea>
                    <button type="button" class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </main>

        <!-- Right Sidebar (Settings & Info) -->
        <aside class="right-sidebar" id="rightSidebar">
            <div class="sidebar-section">
                <h3>Settings</h3>
                <button class="settings-btn" onclick="showApiKeysModal()">
                    üîë API Keys Settings
                </button>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <div class="toggle-switch"></div>
                    <span class="theme-toggle-label">Dark Mode</span>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Model Settings</h3>
                <div class="model-selector">
                    <label for="modelSelect">Model:</label>
                    <select id="modelSelect" onchange="handleModelChange()">
                        <option value="" disabled selected>Loading models...</option>
                    </select>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>System Prompt</h3>
                <div class="system-prompt-selector">
                    <select id="systemPromptSelect" onchange="handleSystemPromptChange()">
                        <!-- Options will be dynamically populated -->
                    </select>
                    <button class="edit-prompts-btn" onclick="showSystemPromptsModal()">‚úèÔ∏è Edit</button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Information</h3>
                <button class="tech-note-btn" onclick="showTechNotesModal()">‚öôÔ∏è Technical Notes</button>
            </div>
        </aside>
    </div>

    <!-- Technical Notes Modal -->
    <div class="modal-overlay" id="techNotesModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Technical Notes</h2>
                <button class="modal-close" onclick="closeTechNotesModal()">&times;</button>
            </div>
            <div class="modal-content">
                <!-- Content loaded dynamically from technical-notes.md -->
                <p style="color: var(--text-muted);">Loading technical notes...</p>
            </div>
        </div>
    </div>

    <!-- System Prompts Modal -->
    <div class="modal-overlay" id="systemPromptsModal">
        <div class="modal">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit System Prompts</h2>
                <button class="modal-close" onclick="closeSystemPromptsModal()">&times;</button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 25px; color: var(--text-muted);">
                    Customize your system prompts below. System prompts guide the AI's behavior and persona.
                </p>
                
                <div id="systemPromptsContainer">
                    <!-- System prompt inputs will be dynamically inserted here -->
                </div>
                
                <button class="btn-save" onclick="addNewSystemPrompt()" style="margin-top: 15px; width: 100%;">+ Add New Prompt</button>
                
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closeSystemPromptsModal()">Cancel</button>
                    <button class="btn-save" onclick="saveSystemPrompts()">Save Prompts</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Keys Settings Modal -->
    <div class="modal-overlay" id="apiKeysModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üîë API Keys Settings</h2>
                <button class="modal-close" onclick="closeApiKeysModal()">&times;</button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 25px; color: var(--text-muted);">
                    Enter your API keys below. Keys are stored locally in your browser and never sent to any server except the respective API providers.
                </p>

                <div class="ollama-toggle-row">
                    <div class="ollama-toggle-text">
                        <h3>Ollama Models</h3>
                        <p class="hint">Show or hide local Ollama models in the model selector.</p>
                    </div>
                    <button type="button" class="btn-ghost" id="ollamaToggleBtn" onclick="toggleOllamaModels()">
                        Hide Ollama Models
                    </button>
                </div>
                
                <div class="form-group">
                    <label>
                        Anthropic API Key
                        <span class="api-key-status" id="anthropicStatus"></span>
                    </label>
                    <input
                        type="password"
                        id="anthropicKeyInput"
                        placeholder="sk-ant-api03-..."
                        autocomplete="off"
                    >
                    <p class="hint">Get your key from <a href="https://console.anthropic.com/" target="_blank" style="color: var(--accent-color);">console.anthropic.com</a></p>
                </div>
                
                <div class="form-group">
                    <label>
                        OpenAI API Key
                        <span class="api-key-status" id="openaiStatus"></span>
                    </label>
                    <input
                        type="password"
                        id="openaiKeyInput"
                        placeholder="sk-..."
                        autocomplete="off"
                    >
                    <p class="hint">Get your key from <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--accent-color);">platform.openai.com</a></p>
                </div>
                
                <div class="form-group">
                    <label>
                        Gemini API Key
                        <span class="api-key-status" id="geminiStatus"></span>
                    </label>
                    <input
                        type="password"
                        id="geminiKeyInput"
                        placeholder="AIza..."
                        autocomplete="off"
                    >
                    <p class="hint">Get your key from <a href="https://aistudio.google.com/apikey" target="_blank" style="color: var(--accent-color);">aistudio.google.com</a></p>
                </div>

                <div class="form-group">
                    <label>
                        DeepSeek API Key
                        <span class="api-key-status" id="deepseekStatus"></span>
                    </label>
                    <input
                        type="password"
                        id="deepseekKeyInput"
                        placeholder="sk-..."
                        autocomplete="off"
                    >
                    <p class="hint">Get your key from <a href="https://platform.deepseek.com/" target="_blank" style="color: var(--accent-color);">platform.deepseek.com</a></p>
                </div>

                <div class="form-group">
                    <label>
                        Grok (xAI) API Key
                        <span class="api-key-status" id="grokStatus"></span>
                    </label>
                    <input
                        type="password"
                        id="grokKeyInput"
                        placeholder="xai-..."
                        autocomplete="off"
                    >
                    <p class="hint">Get your key from <a href="https://console.x.ai/" target="_blank" style="color: var(--accent-color);">console.x.ai</a></p>
                </div>
                
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closeApiKeysModal()">Cancel</button>
                    <button class="btn-save" onclick="saveApiKeys()">Save Keys</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteConfirmModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Confirm Deletion</h2>
                <button class="modal-close" onclick="closeDeleteConfirmModal()">&times;</button>
            </div>
            <div class="modal-content">
                <p style="margin-bottom: 20px; color: var(--text-muted);">
                    Are you sure you want to delete this chat? This action cannot be undone.
                </p>
                <div class="form-actions">
                    <button class="btn-cancel" onclick="closeDeleteConfirmModal()">Cancel</button>
                    <button class="btn-danger" id="confirmDeleteBtn">Delete Chat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="success-toast" id="successToast">API keys saved successfully!</div>

    <!-- SheetJS Library for Excel Support -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
